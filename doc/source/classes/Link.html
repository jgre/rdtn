<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Link</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Link</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/cl_rb.html">
                lib/cl.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Link.html">Link</a> class for uni- and bi-directional links each
link has a specific type (the convergence layer type).
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000092">busy?</a>&nbsp;&nbsp;
      <a href="#M000091">bytesToRead=</a>&nbsp;&nbsp;
      <a href="#M000093">close</a>&nbsp;&nbsp;
      <a href="#M000089">new</a>&nbsp;&nbsp;
      <a href="#M000095">receiverThread</a>&nbsp;&nbsp;
      <a href="#M000094">senderThread</a>&nbsp;&nbsp;
      <a href="#M000090">to_s</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="RerunThread.html">RerunThread</a></span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">MIN_READ_BUFFER</td>
          <td>=</td>
          <td class="context-item-value">1048576</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">bytesToRead</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">policy</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
The policy determines when a link is opened and when it gets closed by the
contact manager. There are three possible values: :alwaysOn (default)
:opporotinistic (the link is opened because of an external event) :onDemand
(link link is only open, when it sends data)

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000089" class="method-detail">
        <a name="M000089"></a>

        <div class="method-heading">
          <a href="#M000089" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000089-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000089-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 62</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
    <span class="ruby-ivar">@@linkCount</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-ivar">@name</span> = <span class="ruby-node">&quot;Link#{@@linkCount}&quot;</span>
    <span class="ruby-ivar">@policy</span> = <span class="ruby-identifier">:alwaysOn</span>
    <span class="ruby-ivar">@bytesToRead</span> = <span class="ruby-constant">MIN_READ_BUFFER</span>
    <span class="ruby-ivar">@senderThreads</span> = <span class="ruby-constant">Queue</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@receiverThreads</span> = <span class="ruby-constant">Queue</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-constant">EventDispatcher</span>.<span class="ruby-identifier">instance</span>().<span class="ruby-identifier">dispatch</span>(<span class="ruby-identifier">:linkCreated</span>, <span class="ruby-keyword kw">self</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000092" class="method-detail">
        <a name="M000092"></a>

        <div class="method-heading">
          <a href="#M000092" class="method-signature">
          <span class="method-name">busy?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true, if this link is actively performing a taks. The default
implementation checks, if there are any sender threads running.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000092-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000092-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 87</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">busy?</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@senderThread</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">thr</span><span class="ruby-operator">|</span> <span class="ruby-identifier">thr</span>.<span class="ruby-identifier">alive?</span>}
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000091" class="method-detail">
        <a name="M000091"></a>

        <div class="method-heading">
          <a href="#M000091" class="method-signature">
          <span class="method-name">bytesToRead=</span><span class="method-args">(bytes)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
When reading data we rather err to the side of greater numbers, as reading
stops anyway, when there is no data left. And we always want to be ready to
read something, as we cannot be sure what the other side is up to.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000091-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000091-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 79</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bytesToRead=</span>(<span class="ruby-identifier">bytes</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bytes</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">bytes</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">MIN_READ_BUFFER</span>
      <span class="ruby-ivar">@bytesToRead</span> = <span class="ruby-identifier">bytes</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000093" class="method-detail">
        <a name="M000093"></a>

        <div class="method-heading">
          <a href="#M000093" class="method-signature">
          <span class="method-name">close</span><span class="method-args">(wait = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Close the link. If <tt>wait</tt> is not <tt>nil</tt>, the method waits for
the given number of seconds before killing busy threads.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000093-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000093-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 93</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>(<span class="ruby-identifier">wait</span> = <span class="ruby-keyword kw">nil</span>)
    <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@senderThreads</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">thr</span> = <span class="ruby-ivar">@senderThreads</span>.<span class="ruby-identifier">pop</span>
      <span class="ruby-identifier">res</span> = <span class="ruby-identifier">thr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">wait</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wait</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">res</span>
        <span class="ruby-identifier">thr</span>.<span class="ruby-identifier">kill</span>
        <span class="ruby-identifier">wait</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">until</span> <span class="ruby-ivar">@receiverThreads</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">thr</span> = <span class="ruby-ivar">@receiverThreads</span>.<span class="ruby-identifier">pop</span>
      <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-identifier">thr</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thr</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-constant">EventDispatcher</span>.<span class="ruby-identifier">instance</span>().<span class="ruby-identifier">dispatch</span>(<span class="ruby-identifier">:linkClosed</span>, <span class="ruby-keyword kw">self</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000090" class="method-detail">
        <a name="M000090"></a>

        <div class="method-heading">
          <a href="#M000090" class="method-signature">
          <span class="method-name">to_s</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000090-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000090-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 72</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_s</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@name</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000095" class="method-detail">
        <a name="M000095"></a>

        <div class="method-heading">
          <a href="#M000095" class="method-signature">
          <span class="method-name">receiverThread</span><span class="method-args">(*args, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000095-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000095-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 117</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">receiverThread</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">spawnThread</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-ivar">@receiverThreads</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ret</span>)
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ret</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000094" class="method-detail">
        <a name="M000094"></a>

        <div class="method-heading">
          <a href="#M000094" class="method-signature">
          <span class="method-name">senderThread</span><span class="method-args">(*args, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000094-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000094-source">
<pre>
<span class="ruby-comment cmt"># File lib/cl.rb, line 111</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">senderThread</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">spawnThread</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-ivar">@senderThreads</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">ret</span>)
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ret</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>